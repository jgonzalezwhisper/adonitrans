jQuery(document).ready(function(s){function a(){var e="*#=-_./!¿?",a="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r="0123456789",t=Math.floor(8*Math.random())+8;let o=[];for(o.push(n(a)),o.push(n(r)),o.push(n(e));o.length<t;)o.push(n("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789*#=-_./!¿?"));return(o=(a=>{for(let e=a.length-1;0<e;e--){var r=Math.floor(Math.random()*(e+1));[a[e],a[r]]=[a[r],a[e]]}return a})(o)).join("")}function n(e){return e.charAt(Math.floor(Math.random()*e.length))}function u(e){var a=s("#extra-fields-container"),r=s("#payment-fields-container");a.hide(),r.hide(),e&&(a.show(),"propietario_vehiculo"!==e&&"conductor"!==e||r.show())}s(document).on("click","#wrap-usuarios .wrap-listado-usuarios .edit-user",function(e){s("body").addClass("actloader");var i=s(this).data("userid");s("#password").text("").val("").removeAttr("required"),s("#user-form #user-id").val(i),s.ajax({url:usuarioAjax.ajaxurl,method:"POST",data:{action:"load_user_data",user_id:i},success:function(e){if(e.success){s("#user-id").val(i),s("#first_name").val(e.data.first_name),s("#last_name").val(e.data.last_name),s("#user_email").val(e.data.email),s("#select_rolesusuario").val(e.data.role).trigger("change"),s("#user_state").val(e.data.meta_estado).trigger("change"),u(e.data.role),s("#user-cedula").val(e.data.meta_cedula),s("#user-telefono").val(e.data.meta_telefono),s("#user-direccion").val(e.data.meta_direccion);var a=e.data.meta_pagos;if(Array.isArray(a)&&0<a.length){var r=!0;if(s.each(a,function(e,a){if(!a.nombre_banco||!a.no_cuenta||!a.tipo_de_cuenta)return r=!1}),r){s(".payment-row input").val("").text("");var t=s(".payment-row").first();if(t.find('input[name="nombre_banco[]"]').val(a[0].nombre_banco),t.find('input[name="no_cuenta[]"]').val(a[0].no_cuenta),t.find('select[name="tipo_de_cuenta[]"]').val(a[0].tipo_de_cuenta),1<a.length)for(var o=1;o<a.length;o++){var n=s(".payment-row").last().clone();n.find("input").val(""),n.find("select").val(""),n.find('input[name="nombre_banco[]"]').val(a[o].nombre_banco),n.find('input[name="no_cuenta[]"]').val(a[o].no_cuenta),n.find('select[name="tipo_de_cuenta[]"]').val(a[o].tipo_de_cuenta),n.append('<a href="#" class="remove-payment-row">✖</a>'),s("#repeater-payment-fields").append(n)}s("#payment-fields-container").show()}}else s(".payment-row input").val("").text("");s('#wrap-usuarios .wrap-gestion-usuarios button[type="submit"]').text("Editar Usuario"),s("#wrap-usuarios .wrap-gestion-usuarios .title").text("Editar Usuario"),s("#wrap-usuarios .wrap-listado-usuarios").hide(),s("#wrap-usuarios .wrap-gestion-usuarios").show(),s("body").removeClass("actloader")}else s("body").removeClass("actloader"),Swal.fire({title:"Algo ha ocurrido!",text:e.data.message,icon:"error",confirmButtonText:"Aceptar"})}})}),s(document).on("click","#wrap-usuarios .wrap-listado-usuarios .delete-user",function(e){e.preventDefault();var a=s(this).data("userid");Swal.fire({title:"¿Estás seguro?",text:"Esta acción eliminará al usuario de forma permanente.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed&&s.ajax({url:usuarioAjax.ajaxurl,method:"POST",data:{action:"delete_user",user_id:a},success:function(e){e.success?Swal.fire("¡Eliminado!","El usuario ha sido eliminado exitosamente.","success").then(()=>{var e=usuarioAjax.plugin_url+"includes/parts/panel/usuario.php";s.ajax({url:e,method:"GET",success:function(e){s("#informacion").html(e),initUsuarios()},error:function(){s("#informacion").html("<p>Error al cargar el contenido. Intenta nuevamente.</p>")}})}):Swal.fire("Error",e.data.message||"No se pudo eliminar el usuario.","error")},error:function(){Swal.fire("Error","Hubo un problema al intentar eliminar el usuario.","error")}})})}),s(document).on("click","#crear-usuario",function(e){e.preventDefault(),s("#user-form")[0].reset(),s('#wrap-usuarios .wrap-gestion-usuarios button[type="submit"]').text("Crear Usuario"),s("#wrap-usuarios .wrap-listado-usuarios").hide(),s("#wrap-usuarios .wrap-gestion-usuarios").show()}),s(document).on("click",'#wrap-usuarios .wrap-gestion-usuarios button[type="button"]',function(e){s("#user-form")[0].reset(),s("#user-id").text("").val(""),s("#select_rolesusuario").val(null).trigger("change"),s("#wrap-usuarios .wrap-gestion-usuarios").hide(),s("#wrap-usuarios .wrap-listado-usuarios").show()}),s(document).on("change","#select_rolesusuario",function(e){e.preventDefault(),u(s(this).val())}),s(document).on("click","#add-payment-row",function(e){e.preventDefault();e=s(".payment-row").last().clone();e.find("input").val(""),e.find("select").val(""),e.find(".remove-payment-row").remove(),e.append('<a href="#" class="remove-payment-row">✖</a>'),s("#repeater-payment-fields").append(e)}),s(document).on("click",".remove-payment-row",function(e){e.preventDefault(),s(this).closest(".payment-row").remove()}),s(document).on("click","#generate-password",function(e){e.preventDefault();e=a();s("#password").val(e)}),s(document).on("focusin","#user-form",function(){s(this).validate({rules:{first_name:{required:!0},last_name:{required:!0},user_email:{required:!0,email:!0},select_rolesusuario:{required:!0},password:{required:function(){return""===s("#user-id").val()},checkPassword:function(){return""===s("#user-id").val()}}},messages:{first_name:"Ingresa tu nombre",last_name:"Ingresa tu apellido",user_email:{required:"Este campo es obligatorio",email:"Ingresa un correo electrónico valido"},select_rolesusuario:"Seleccione un rol",password:{required:"Ingresa tu contraseña nueva",checkPassword:"Tu contraseña debe cumplir con los requisitos"}},submitHandler:function(e){e=new FormData(e);e.append("action","create_user"),s.ajax({url:usuarioAjax.ajaxurl,type:"POST",data:e,contentType:!1,processData:!1,beforeSend:function(){s("body").addClass("actloader")},success:function(e){s("body").removeClass("actloader"),e.success?Swal.fire({title:"¡Éxito!",text:e.data.message,icon:"success",confirmButtonText:"Aceptar"}).then(e=>{e.isConfirmed&&(s("#user-form")[0].reset(),actform=s("#user-form").data("action"),urlredi="includes/parts/panel/usuario.php","misdatos"==actform&&(urlredi="includes/parts/panel/cuenta.php"),e=usuarioAjax.plugin_url+urlredi,s.ajax({url:e,method:"GET",success:function(e){s("#informacion").html(e),initUsuarios()},error:function(){s("#informacion").html("<p>Error al cargar el contenido. Intenta nuevamente.</p>")}}))}):Swal.fire({title:"Algo ha ocurrido!",text:e.data.message,icon:"error",confirmButtonText:"Aceptar"})},error:function(){s("body").removeClass("actloader"),Swal.fire({title:"¡Error!",text:"Hubo un problema al procesar el formulario. Por favor intenta nuevamente.",icon:"error",confirmButtonText:"Aceptar"})}})}})}),s(document).on("submit","#user-form",function(e){e.preventDefault(),s(this).valid()&&s(this).submit()})});
//# sourceMappingURL=usuarios.js.map
